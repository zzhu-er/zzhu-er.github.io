# CI/CD

## 什么是CI/CD

CI/CD即CI与CD的结合，属于DevOps的一部分。CI/CD将大多数甚至所有传统开发模式中为了让代码从提交到生产需要人工干预的工作自动化，包括构建，测试，部署以及基础设施配置。通过CI/CD，开发团队所做的代码修改会被自动部署和交付。  

与传统模式相比，CI/CD作为敏捷开发的一部分，能帮助团队更顺畅地合作，更频繁地发布软件，更快速地响应需求。

### 什么是CI

### 什么是CD

## CI vs CD  

通常来说，我们总是将CI和CD看做一个整体，它们共同将我们的整个DevOps流程自动化。但是，这两个概念之间实际上有一些关键区别。  

1. 通常，CI的触发频率要比CD更加频繁。  
2. CI一般用来指代自动构建以及测试代码变动的过程  

总的来说，CI更多是关于让代码准备好被发布（build/test），而CD是发布代码的环节（deploy/release）。

- **Continuous Integration(CI)**:  一种每天多次将所有人的代码修改合并到主分支的实践。在合并后自动测试所有更改并进行构建。主要避免了如果开发人员长时间未合并代码修改可能带来的冲突问题。
- **Continuous Delivery(CD)**: 一种代码修改在构建后自动部署到测试，暂存甚至生产环境的实践。涵盖了从基础设施配置到部署至测试或生产环境的所有内容。与CI高度相关，结合使用。  

## CI/CD的几个基本要素  

1. 单一源存储库  
   在我们的存储库中包含所有构建所需的脚本和文件至关重要。  
2. 基于主干开发  
   频繁地尽早地将代码整合在主分支中（小步提交），尽量只使用主分支开发，避免使用别的分支。分支合并容易产生冲突。避免单次合并超过一个提交。
3. 自动构建  
   脚本应该包含所有需要的内容以便我们通过单行命令进行构建。CI流程应该将源代码自动打包并编译成可用的程序。
4. 基于测试的构建  
   CI/CD应该基于持续测试，我们应该确保测试失败将导致编译失败。在构建前使用静态测试脚本来检查代码质量，只有通过静态测试的代码才允许被构建。
5. 频繁迭代  
   进行小而频繁的迭代而不是重大更改。这可以保证我们遇见问题或冲突时可以轻松回滚。
6. 稳定的测试环境  
   我们不能在已经上线的生产环境中测试新代码。因此我们需要一个与真实环境一致或者相似的测试环境。同时使用严格的测试脚本来检测识别构建前测试中遗漏的错误。
7. 可预测的部署  
   部署应该是常规且低风险的，这是由严格且可靠的测试及验证流程保证的。因此，团队应该有信心随时轻松进行部署。频繁部署有限的改动也可以降低风险，并让我们轻松回滚。
8. 最大程度可见  
   每个成员都应该能够访问Repo中的所有信息，包括最新的变动。使用VCS进行管理，以便识别最新版本。每个人都可以监控进度并识别潜在问题。  

## CI/CD的价值  

### 技术  

1. 解放开发人员  
   随着很多繁琐步骤的自动化，团队将有更多时间进行新功能的开发，大大提高了生产力。
2. 减少上下文切换  
   CI/CD让开发人员获得针对自己代码的实时反馈，因此可以一直专注在同一件事上，直到完全没有问题，降低认知负担。因为每次只工作在一小部分代码上，开发者可以更轻松地调试寻找并解决错误。
3. 快速回滚  
   CI/CD帮助我们减少MTTR（mean time to resolution）。良好的CI/CD实践伴随着频繁的小步提交，因此错误更容易定位，当遇到incident时，开发者可以选择快速解决或者直接回滚（小步提交不会影响其他功能）。

### 业务  

1. 用户/客户满意度  
   通过应用CI/CD，我们发布的产品具有更少的问题，因此用户体验更好。这让我们的客户满意度更高，对接下来的合作更有信心。
2. 抢占市场  
   通过CI/CD，我们的改动随时都可以部署上生产，因此我们有能力将新功能更迅速地推向市场。开发成本更低，周转更快，团队可以迅速投入到下一个功能的开发。
3. 减少跳票的可能  
   由于部署是可预测的，因此产品关键上线日期的不确定性更小。将业务拆分成很多小的迭代让团队更容易完成每个阶段的目标并追踪进度。按时上线的可能性大大增加。
4. 拒绝滚雪球  
   通过在开发周期的早期频繁地对每一小批代码进行测试，未来需要紧急修复的情况会显著减少。整个开发周期更加平稳，团队压力更小。  
